<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>오손도손 · 게시판</title>
  <link rel="stylesheet" href="../css/home.css" />
  <style>
    *{box-sizing:border-box}
    main{max-width:1100px; margin:24px auto; padding:0 20px}

    .toolbar{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center}
    .search{display:flex; gap:8px; align-items:center; background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:10px 12px}
    .search input{flex:1; background:transparent; border:0; outline:none; color:inherit}
    .filters{display:flex; gap:8px; flex-wrap:wrap}

    .chip{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--panel-2); color:var(--muted); cursor:pointer}
    .chip.active{background:linear-gradient(135deg, rgba(46,125,50,.16), rgba(167,215,181,.08)); color:var(--text)}

    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin:16px 0}
    .tab{padding:10px 14px; border-radius:999px; border:1px solid var(--border); background:var(--panel-2); color:var(--muted); font-weight:600; cursor:pointer}
    .tab.active{background:linear-gradient(135deg,var(--accent),#7bbf9f); color:#0b3d2e; border-color:transparent}

    .list{display:grid; gap:16px; margin-bottom:20px}
    .item{display:grid; grid-template-columns:1fr auto; gap:12px; padding:16px; background:linear-gradient(180deg,var(--panel),var(--panel-2)); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow)}
    .item:hover{outline:1px solid rgba(46,125,50,.25); outline-offset:2px}
    .title{font-weight:800; margin:0 0 6px}
    .meta{display:flex; gap:10px; color:var(--muted); font-size:.9rem; margin:0}
    .meta .pill{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background:var(--panel-2)}
    .right{display:flex; flex-direction:column; align-items:flex-end; gap:8px}
    .stats{display:flex; gap:10px; color:var(--muted)}
    .stat{display:inline-flex; align-items:center; gap:6px}

    .fab{position:fixed; right:20px; bottom:20px; padding:14px 16px; border-radius:16px; background:linear-gradient(135deg,var(--accent),#7bbf9f); color:#0b3d2e; font-weight:900; border:0; box-shadow:var(--shadow)}
    footer{max-width:1100px; margin:24px auto 40px; padding:0 20px; color:var(--muted); font-size:.9rem}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="brand-badge"><svg viewBox="0 0 24 24"><path d="M12 3a9 9 0 100 18 9 9 0 000-18Zm0 3.5a1.25 1.25 0 110 2.5 1.25 1.25 0 010-2.5Zm0 4.25a.75.75 0 01.75.75v6.25a.75.75 0 01-1.5 0V11.5a.75.75 0 01.75-.75Z"/></svg></div>
        <div>오손도손 <span style="color:var(--muted); font-weight:600">게시판</span></div>
      </div>
      <div class="spacer"></div>
      <nav class="top-actions" aria-label="상단 내비">
        <a class="btn" href="home.html">홈</a>
        <a class="btn" href="data_analysis.html">통계</a>
        <a class="btn" href="settings.html">설정</a>
        <a class="btn btn-primary" href="/messages/thread.html">메시지</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="toolbar">
      <label class="search" aria-label="게시글 검색">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="opacity:.7"><path d="M10 2a8 8 0 105.293 14.293l4.707 4.707 1.414-1.414-4.707-4.707A8 8 0 0010 2zm0 2a6 6 0 110 12 6 6 0 010-12z"/></svg>
        <input id="searchInput" placeholder="검색: 제목·내용·작성자" aria-label="검색어 입력" />
      </label>
      
    </div>

    <div class="tabs" role="tablist" aria-label="카테고리">
      <a class="tab active" href="#all">전체</a>
      <a class="tab" href="#notice">공지</a>
      <a class="tab" href="#life">생활/장보기</a>
      <a class="tab" href="#noise">소음/배려</a>
      <a class="tab" href="#event">이벤트/모임</a>
      <a class="tab" href="#free">자유</a>
    </div>

    <div id="all" class="list" aria-label="전체 게시글"></div>
    <div id="notice" class="list" aria-label="공지" hidden></div>
    <div id="life" class="list" aria-label="생활/장보기" hidden></div>
    <div id="noise" class="list" aria-label="소음/배려" hidden></div>
    <div id="event" class="list" aria-label="이벤트/모임" hidden></div>
    <div id="free" class="list" aria-label="자유" hidden></div>
  </main>

  <a class="fab" href="write.html">📝 글쓰기</a>

  <footer>
    <div>※ 데이터는 <strong>data/posts.json</strong>에서 불러옵니다. 현재 화면은 <strong>HTML/CSS/JS 프로토타입</strong>입니다.</div>
  </footer>

  <script>
    (function(){
      const sections = ['all','notice','life','noise','event','free'];
      const tabs = Array.from(document.querySelectorAll('.tabs .tab'));
      const containers = Object.fromEntries(sections.map(id => [id, document.getElementById(id)]));
      const searchInput = document.getElementById('searchInput');
      let postsCache = [];

      function createItem(post){
        const a = document.createElement('a');
        a.className = 'item';
        a.href = '/board/post.html';
        const left = document.createElement('div');
        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = post.title;
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `<span>${post.author}</span><span>·</span><span>${post.time}</span><span class="pill">${post.tag}</span>`;
        left.appendChild(title);
        left.appendChild(meta);

        const right = document.createElement('div');
        right.className = 'right';
        const stats = document.createElement('div');
        stats.className = 'stats';
        const cs = post.stats || {comments:0, likes:0, views:0};
        stats.innerHTML = `<span class="stat">💬 ${cs.comments}</span><span class="stat">👍 ${cs.likes}</span><span class="stat">👀 ${cs.views}</span>`;
        right.appendChild(stats);

        a.appendChild(left);
        a.appendChild(right);
        return a;
      }

      function resolveCategory(post){
        return post.category || 'free';
      }

      function timeScore(t){
        const s=(t||'').trim();
        if(!s) return -1e12;
        if(/(\d+)\s*분 전/.test(s)) return 1e9 - parseInt(s)*60;
        if(/(\d+)\s*시간 전/.test(s)) return 1e8 - parseInt(s)*3600;
        if(s==='어제') return 1e7 - 24*3600;
        if(/(\d+)\s*일 전/.test(s)) return 1e6 - parseInt(s)*24*3600;
        return -1e11;
      }

      async function loadAndRender(){
        try{
          const res=await fetch('../data/posts.json',{cache:'no-store'});
          if(!res.ok) throw new Error('HTTP '+res.status);
          const data=await res.json();
          postsCache=Array.isArray(data.posts)?data.posts:[];
          render();
        }catch(e){
          console.error(e);
        }
      }

      function currentCategory(){
        const h=(location.hash||'#all').replace('#','');
        return sections.includes(h)?h:'all';
      }

      function render(){
        const cat=currentCategory();
        const q=(searchInput.value||'').trim().toLowerCase();
        sections.forEach(id=>{ containers[id].innerHTML=''; });

        const sorted=postsCache
          .slice()
          .sort((a,b)=>timeScore(b.time)-timeScore(a.time))
          .filter(p=>{
            if(!q) return true;
            return [p.title,p.author,p.tag].join(' ').toLowerCase().includes(q);
          });

        if(cat==='all'){
          sorted.forEach(p=>containers.all.appendChild(createItem(p)));
        }else{
          const list=sorted.filter(p=>resolveCategory(p)===cat);
          if(list.length===0){
            const empty=document.createElement('div');
            empty.className='item';
            empty.innerHTML='<div class="title">이 카테고리에 글이 없어요</div>';
            containers[cat].appendChild(empty);
          }else{
            list.forEach(p=>containers[cat].appendChild(createItem(p)));
          }
        }

        sections.forEach(s=>{
          const show=(cat==='all')?(s==='all'):(s===cat);
          containers[s].toggleAttribute('hidden',!show);
        });

        tabs.forEach(t=>t.classList.toggle('active', t.getAttribute('href')==='#'+cat));
      }

      tabs.forEach(t=>t.addEventListener('click',e=>{
        const href=t.getAttribute('href');
        if(href&&href.startsWith('#')){
          e.preventDefault();
          history.pushState(null,'',href);
          render();
        }
      }));
      window.addEventListener('hashchange', render);
      searchInput.addEventListener('input', render);

      loadAndRender();
    })();
  </script>
</body>
</html>
